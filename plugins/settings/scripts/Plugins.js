"use strict";exports.__esModule=!0;var SettingsAPI_1=require("./SettingsAPI"),pluginmanager_1=require("@mcscriptstudiocode/pluginmanager"),$=require("jquery"),fs=require("fs"),api=pluginmanager_1.PluginManager.instance.api;function createInfoTableEntry(e,n){var t=[];return t[0]=document.createElement("tr"),t[1]=document.createElement("th"),t[2]=document.createElement("th"),t[1].innerText=e,t[2].innerText=n,t[0].appendChild(t[1]),t[0].appendChild(t[2]),t[0]}function createConfigEditor(e,n,t){if(void 0===n&&(n=pluginmanager_1.guid()),void 0===t&&(t=pluginmanager_1.guid()),fs.existsSync(e.path+"/config.yml")){var a=document.createElement("div"),i=document.createElement("textarea"),r=document.createElement("button"),d=document.createElement("h3");return a.classList.add("config"),d.innerText="Config",i.value=fs.readFileSync(e.path+"/config.yml","utf8"),i.id=n,r.innerText="Save",r.id=t,a.appendChild(d),a.appendChild(i),a.appendChild(r),a}}SettingsAPI_1.settingsapi.push({name:"plugins",renderContent:function(){var e=document.createElement("div"),u=document.createElement("ul"),p=document.createElement("div");return p.style.display="none",e.id="settings_plugins",u.classList.add("settings_plugins","menu"),p.classList.add("settings_plugins","content"),api.plugins.forEach(function(t){var e=document.createElement("li"),n=document.createElement("p"),a=document.createElement("div"),i=document.createElement("h3"),r=document.createElement("table");a.classList.add("infos"),r.classList.add("infostable"),i.classList.add("infoheadline"),i.innerText="Infos",r.appendChild(createInfoTableEntry("Name",""+t.name)),r.appendChild(createInfoTableEntry("Url",""+t.url)),r.appendChild(createInfoTableEntry("Version","v"+t.version)),r.appendChild(createInfoTableEntry("Author",""+t.author)),r.appendChild(createInfoTableEntry("Author's url",""+t.author_url)),a.appendChild(i),a.appendChild(r),n.innerText=t.name,e.appendChild(n);var d=pluginmanager_1.guid(),l=pluginmanager_1.guid(),c=createConfigEditor(t,d,l);$(e).click(function(){if($(u).hide(),$(p).show(),$(p).empty(),$(p).append(a),c){$(p).append(c);var n=api.getAPI("editor").createEditor(document.getElementById(d),"text/x-yaml","3024-night");$("#"+l).click(function(e){return e.preventDefault(),fs.writeFileSync(t.path+"/config.yml",n.getValue(),"utf8"),!1})}}),u.appendChild(e)}),e.appendChild(u),e.appendChild(p),e}});