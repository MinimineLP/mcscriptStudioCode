{"version":3,"sources":["SiteApi.js","SiteApi.ts"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","exports","__esModule","http","require","https","fs","loadSite","host","path","protocoll","ret","options","request","_a","Object","res","data","on","chunk","console","log","message","end","Error","parseURL","url","match","startsWith","downloadFile","out","file","createWriteStream","get","response","pipe","SiteApi","global"],"mappings":"AAAA;;AACA,IAAIA,YAAa,aAAQ,UAAKA,SAAd,IAA4B,UAAUC,OAAV,EAAmBC,UAAnB,EAA+BC,CAA/B,EAAkCC,SAAlC,EAA6C;AACrF,WAAO,KAAKD,MAAMA,IAAIE,OAAV,CAAL,EAAyB,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AACvD,iBAASC,SAAT,CAAmBC,KAAnB,EAA0B;AAAE,gBAAI;AAAEC,qBAAKN,UAAUO,IAAV,CAAeF,KAAf,CAAL;AAA8B,aAApC,CAAqC,OAAOG,CAAP,EAAU;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC3F,iBAASC,QAAT,CAAkBJ,KAAlB,EAAyB;AAAE,gBAAI;AAAEC,qBAAKN,UAAU,OAAV,EAAmBK,KAAnB,CAAL;AAAkC,aAAxC,CAAyC,OAAOG,CAAP,EAAU;AAAEL,uBAAOK,CAAP;AAAY;AAAE;AAC9F,iBAASF,IAAT,CAAcI,MAAd,EAAsB;AAAEA,mBAAOC,IAAP,GAAcT,QAAQQ,OAAOL,KAAf,CAAd,GAAsC,IAAIN,CAAJ,CAAM,UAAUG,OAAV,EAAmB;AAAEA,wBAAQQ,OAAOL,KAAf;AAAwB,aAAnD,EAAqDO,IAArD,CAA0DR,SAA1D,EAAqEK,QAArE,CAAtC;AAAuH;AAC/IH,aAAK,CAACN,YAAYA,UAAUa,KAAV,CAAgBhB,OAAhB,EAAyBC,cAAc,EAAvC,CAAb,EAAyDS,IAAzD,EAAL;AACH,KALM,CAAP;AAMH,CAPD;AAQA,IAAIO,cAAe,aAAQ,UAAKA,WAAd,IAA8B,UAAUjB,OAAV,EAAmBkB,IAAnB,EAAyB;AACrE,QAAIC,IAAI,EAAEC,OAAO,CAAT,EAAYC,MAAM,gBAAW;AAAE,gBAAIC,EAAE,CAAF,IAAO,CAAX,EAAc,MAAMA,EAAE,CAAF,CAAN,CAAY,OAAOA,EAAE,CAAF,CAAP;AAAc,SAAvE,EAAyEC,MAAM,EAA/E,EAAmFC,KAAK,EAAxF,EAAR;AAAA,QAAsGC,CAAtG;AAAA,QAAyGC,CAAzG;AAAA,QAA4GJ,CAA5G;AAAA,QAA+GK,CAA/G;AACA,WAAOA,IAAI,EAAEjB,MAAMkB,KAAK,CAAL,CAAR,EAAiB,SAASA,KAAK,CAAL,CAA1B,EAAmC,UAAUA,KAAK,CAAL,CAA7C,EAAJ,EAA4D,OAAOC,MAAP,KAAkB,UAAlB,KAAiCF,EAAEE,OAAOC,QAAT,IAAqB,YAAW;AAAE,eAAO,IAAP;AAAc,KAAjF,CAA5D,EAAgJH,CAAvJ;AACA,aAASC,IAAT,CAAcG,CAAd,EAAiB;AAAE,eAAO,UAAUC,CAAV,EAAa;AAAE,mBAAOvB,KAAK,CAACsB,CAAD,EAAIC,CAAJ,CAAL,CAAP;AAAsB,SAA5C;AAA+C;AAClE,aAASvB,IAAT,CAAcwB,EAAd,EAAkB;AACd,YAAIR,CAAJ,EAAO,MAAM,IAAIS,SAAJ,CAAc,iCAAd,CAAN;AACP,eAAOf,CAAP;AAAU,gBAAI;AACV,oBAAIM,IAAI,CAAJ,EAAOC,MAAMJ,IAAIW,GAAG,CAAH,IAAQ,CAAR,GAAYP,EAAE,QAAF,CAAZ,GAA0BO,GAAG,CAAH,IAAQP,EAAE,OAAF,MAAe,CAACJ,IAAII,EAAE,QAAF,CAAL,KAAqBJ,EAAEa,IAAF,CAAOT,CAAP,CAArB,EAAgC,CAA/C,CAAR,GAA4DA,EAAEhB,IAAlG,KAA2G,CAAC,CAACY,IAAIA,EAAEa,IAAF,CAAOT,CAAP,EAAUO,GAAG,CAAH,CAAV,CAAL,EAAuBnB,IAA9I,EAAoJ,OAAOQ,CAAP;AACpJ,oBAAII,IAAI,CAAJ,EAAOJ,CAAX,EAAcW,KAAK,CAACA,GAAG,CAAH,IAAQ,CAAT,EAAYX,EAAEd,KAAd,CAAL;AACd,wBAAQyB,GAAG,CAAH,CAAR;AACI,yBAAK,CAAL,CAAQ,KAAK,CAAL;AAAQX,4BAAIW,EAAJ,CAAQ;AACxB,yBAAK,CAAL;AAAQd,0BAAEC,KAAF,GAAW,OAAO,EAAEZ,OAAOyB,GAAG,CAAH,CAAT,EAAgBnB,MAAM,KAAtB,EAAP;AACnB,yBAAK,CAAL;AAAQK,0BAAEC,KAAF,GAAWM,IAAIO,GAAG,CAAH,CAAJ,CAAWA,KAAK,CAAC,CAAD,CAAL,CAAU;AACxC,yBAAK,CAAL;AAAQA,6BAAKd,EAAEK,GAAF,CAAMY,GAAN,EAAL,CAAkBjB,EAAEI,IAAF,CAAOa,GAAP,GAAc;AACxC;AACI,4BAAI,EAAEd,IAAIH,EAAEI,IAAN,EAAYD,IAAIA,EAAEe,MAAF,GAAW,CAAX,IAAgBf,EAAEA,EAAEe,MAAF,GAAW,CAAb,CAAlC,MAAuDJ,GAAG,CAAH,MAAU,CAAV,IAAeA,GAAG,CAAH,MAAU,CAAhF,CAAJ,EAAwF;AAAEd,gCAAI,CAAJ,CAAO;AAAW;AAC5G,4BAAIc,GAAG,CAAH,MAAU,CAAV,KAAgB,CAACX,CAAD,IAAOW,GAAG,CAAH,IAAQX,EAAE,CAAF,CAAR,IAAgBW,GAAG,CAAH,IAAQX,EAAE,CAAF,CAA/C,CAAJ,EAA2D;AAAEH,8BAAEC,KAAF,GAAUa,GAAG,CAAH,CAAV,CAAiB;AAAQ;AACtF,4BAAIA,GAAG,CAAH,MAAU,CAAV,IAAed,EAAEC,KAAF,GAAUE,EAAE,CAAF,CAA7B,EAAmC;AAAEH,8BAAEC,KAAF,GAAUE,EAAE,CAAF,CAAV,CAAgBA,IAAIW,EAAJ,CAAQ;AAAQ;AACrE,4BAAIX,KAAKH,EAAEC,KAAF,GAAUE,EAAE,CAAF,CAAnB,EAAyB;AAAEH,8BAAEC,KAAF,GAAUE,EAAE,CAAF,CAAV,CAAgBH,EAAEK,GAAF,CAAMc,IAAN,CAAWL,EAAX,EAAgB;AAAQ;AACnE,4BAAIX,EAAE,CAAF,CAAJ,EAAUH,EAAEK,GAAF,CAAMY,GAAN;AACVjB,0BAAEI,IAAF,CAAOa,GAAP,GAAc;AAXtB;AAaAH,qBAAKf,KAAKiB,IAAL,CAAUnC,OAAV,EAAmBmB,CAAnB,CAAL;AACH,aAjBS,CAiBR,OAAOR,CAAP,EAAU;AAAEsB,qBAAK,CAAC,CAAD,EAAItB,CAAJ,CAAL,CAAae,IAAI,CAAJ;AAAQ,aAjBzB,SAiBkC;AAAED,oBAAIH,IAAI,CAAR;AAAY;AAjB1D,SAkBA,IAAIW,GAAG,CAAH,IAAQ,CAAZ,EAAe,MAAMA,GAAG,CAAH,CAAN,CAAa,OAAO,EAAEzB,OAAOyB,GAAG,CAAH,IAAQA,GAAG,CAAH,CAAR,GAAgB,KAAK,CAA9B,EAAiCnB,MAAM,IAAvC,EAAP;AAC/B;AACJ,CA1BD;AA2BAyB,QAAQC,UAAR,GAAqB,IAArB;ACpCA,IAAAC,OAAAC,QAAA,MAAA,CAAA;AACA,IAAAC,QAAAD,QAAA,OAAA,CAAA;AACA,IAAAE,KAAAF,QAAA,IAAA,CAAA;AAIA,SAAsBG,QAAtB,CACEC,IADF,EAEE/B,IAFF,EAGEgC,IAHF,EAIEC,SAJF,EAI6B;AAD3B,QAAAD,SAAA,KAAA,CAAA,EAAA;AAAAA,eAAA,GAAA;AAAkB;AAClB,QAAAC,cAAA,KAAA,CAAA,EAAA;AAAAA,oBAAA,OAAA;AAA2B;ADiCzB,WAAOjD,UAAU,IAAV,EAAgB,KAAK,CAArB,EAAwB,KAAK,CAA7B,EAAgC,YAAY;AAC/C,YAAIkD,GAAJ,EAASC,OAAT,EAAkBC,OAAlB,EAA2BD,OAA3B,EAAoCC,OAApC;AACA,eAAOlC,YAAY,IAAZ,EAAkB,UAAUmC,EAAV,EAAc;AACnC,oBAAQA,GAAGhC,KAAX;AACI,qBAAK,CAAL;ACnCd,wBAAI0B,gBAAgBO,MAApB,EAA4B;AAC1B,4BAAIP,KAAKA,IAAL,IAAaA,KAAKC,IAAtB,EAA4B;AAC1B,gCAAID,KAAKE,SAAT,EAAoBA,YAAYF,KAAKE,SAAjB;AACpBD,mCAAOD,KAAKC,IAAZ;AACAD,mCAAOA,KAAKA,IAAZ;AACD;AACF;ADsCiB,wBAAI,ECpClBE,aAAa,ODoCK,CAAJ,ECpCd,OAAA,CAAA,CAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AACEE,8BAAU,EAAEJ,MAAMA,IAAR,EAAcC,MAAMA,IAApB,EAAV;AACAI,8BAAUR,MAAMQ,OAAN,CAAcD,OAAd,EAAuB,UAASI,GAAT,EAAY;AAC/C,4BAAIC,OAAO,EAAX;AACAD,4BAAIE,EAAJ,CAAO,MAAP,EAAe,UAASC,KAAT,EAAc;AAC3BF,oCAAQE,KAAR;AACD,yBAFD;AAGAH,4BAAIE,EAAJ,CAAO,KAAP,EAAc,YAAA;AACZzC,iCAAKwC,IAAL;AACD,yBAFD;AAGD,qBARa,CAAV;AASJJ,4BAAQK,EAAR,CAAW,OAAX,EAAoB,UAAS7C,CAAT,EAAU;AAC5B+C,gCAAQC,GAAR,CAAYhD,EAAEiD,OAAd;AACD,qBAFD;AAGA,2BAAA,CAAA,CAAA,CAAA,SAAA,EAAMT,QAAQU,GAAR,EAAN,CAAA;ADqCY,qBAAK,CAAL;ACrCZT,uBAAA/B,IAAA;ADuCgB,2BAAO,CAAC,CAAD,CAAG,SAAH,EAAc,CAAd,CAAP;AACJ,qBAAK,CAAL;AACI,wBAAI,ECxCX2B,aAAa,MDwCF,CAAJ,ECxCP,OAAA,CAAA,CAAA,CAAA,SAAA,EAAA,CAAA,CAAA;AACLE,8BAAU,EAAEJ,MAAMA,IAAR,EAAcC,MAAMA,IAApB,EAAV;AACAI,8BAAUV,KAAKU,OAAL,CAAaD,OAAb,EAAsB,UAASI,GAAT,EAAY;AAC9C,4BAAIC,OAAO,EAAX;AACAD,4BAAIE,EAAJ,CAAO,MAAP,EAAe,UAASC,KAAT,EAAc;AAC3BF,oCAAQE,KAAR;AACD,yBAFD;AAGAH,4BAAIE,EAAJ,CAAO,KAAP,EAAc,YAAA;AACZzC,iCAAKwC,IAAL;AACD,yBAFD;AAGD,qBARa,CAAV;AASJJ,4BAAQK,EAAR,CAAW,OAAX,EAAoB,UAAS7C,CAAT,EAAU;AAC5B+C,gCAAQC,GAAR,CAAYhD,EAAEiD,OAAd;AACD,qBAFD;AAGA,2BAAA,CAAA,CAAA,CAAA,SAAA,EAAMT,QAAQU,GAAR,EAAN,CAAA;ADyCY,qBAAK,CAAL;ACzCZT,uBAAA/B,IAAA;AD2CgB,2BAAO,CAAC,CAAD,CAAG,SAAH,EAAc,CAAd,CAAP;AACJ,qBAAK,CAAL;AC3CP,0BAAM,IAAIyC,KAAJ,CAAU,wBAAwBd,SAAxB,GAAoC,GAA9C,CAAN;AD4CO,qBAAK,CAAL;AC3Cd,2BAAA,CAAA,CAAA,CAAA,UAAA,EAAOC,GAAP,CAAA;ADLU;AAkDH,SAnDM,CAAP;AAoDH,KAtDM,CAAP;ACSH;AA9CDV,QAAAM,QAAA,GAAAA,QAAA;AAgDA,SAAgBkB,QAAhB,CAAyBC,GAAzB,EAAoC;AAClC,QAAIlB,IAAJ,EAAUC,IAAV,EAAgBC,SAAhB;AACA,QAAIiB,QAAQD,IAAIC,KAAJ,CAAU,+BAAV,CAAZ;AACA,QACEA,SAAS,IAAT,IACAA,MAAM5B,MAAN,GAAe,CADf,IAEA,OAAO4B,MAAM,CAAN,CAAP,KAAoB,QAFpB,IAGAA,MAAM,CAAN,EAAS5B,MAAT,GAAkB,CAJpB,EAKE;AACAS,eAAOmB,MAAM,CAAN,CAAP;AACD;AAED,QAAIA,QAAQD,IAAIC,KAAJ,CAAU,gCAAV,CAAZ;AACA,QACEA,SAAS,IAAT,IACAA,MAAM5B,MAAN,GAAe,CADf,IAEA,OAAO4B,MAAM,CAAN,CAAP,KAAoB,QAFpB,IAGAA,MAAM,CAAN,EAAS5B,MAAT,GAAkB,CAJpB,EAKE;AACAU,eAAOkB,MAAM,CAAN,CAAP;AACD,KAPD,MAOO;AACL,eAAO,IAAP;AACD;AACD,QAAID,IAAIE,UAAJ,CAAe,UAAf,CAAJ,EAAgClB,YAAY,OAAZ;AAChC,QAAIgB,IAAIE,UAAJ,CAAe,SAAf,CAAJ,EAA+BlB,YAAY,MAAZ;AAC/B,WAAO,EAAEF,MAAMA,IAAR,EAAcC,MAAMA,IAApB,EAA0BC,WAAWA,SAArC,EAAP;AACD;AA1BDT,QAAAwB,QAAA,GAAAA,QAAA;AA4BA,SAAgBI,YAAhB,CAA6BC,GAA7B,EAA0CJ,GAA1C,EAAqD;AACnD,WAAO,IAAI5D,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAgB;AACjC,YAAI+D,OAAOzB,GAAG0B,iBAAH,CAAqBF,GAArB,CAAX;AACA,YAAIjB,OAAJ;AACA,YAAIa,IAAIE,UAAJ,CAAe,OAAf,CAAJ,EAA6B;AAC3BR,oBAAQC,GAAR,CAAYK,GAAZ,EAAiBI,GAAjB,EAAsB,OAAtB;AACAjB,sBAAUR,MAAM4B,GAAN,CAAUP,GAAV,EAAe,UAASQ,QAAT,EAAiB;AACxCA,yBAASC,IAAT,CAAcJ,IAAd;AACD,aAFS,CAAV;AAGD,SALD,MAMElB,UAAUV,KAAK8B,GAAL,CAASP,GAAT,EAAc,UAASQ,QAAT,EAAiB;AACvCA,qBAASC,IAAT,CAAcJ,IAAd;AACD,SAFS,CAAV;AAGFA,aAAKb,EAAL,CAAQ,QAAR,EAAkBnD,OAAlB,EAA2BmD,EAA3B,CAA8B,OAA9B,EAAuClD,MAAvC;AACA6C,gBAAQU,GAAR;AACD,KAdM,CAAP;AAeD;AAhBDtB,QAAA4B,YAAA,GAAAA,YAAA;AAkBW5B,QAAAmC,OAAA,GAWP;AACF7B,cAAUA,QADR;AAEFkB,cAAUA,QAFR;AAGFI,kBAAcA;AAHZ,CAXO;AAiBXQ,OAAOD,OAAP,GAAiBnC,QAAAmC,OAAjB","file":"SiteApi.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexports.__esModule = true;\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar fs = require(\"fs\");\nfunction loadSite(host, then, path, protocoll) {\n    if (path === void 0) { path = \"/\"; }\n    if (protocoll === void 0) { protocoll = \"https\"; }\n    return __awaiter(this, void 0, void 0, function () {\n        var ret, options, request, options, request;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (host instanceof Object) {\n                        if (host.host && host.path) {\n                            if (host.protocoll)\n                                protocoll = host.protocoll;\n                            path = host.path;\n                            host = host.host;\n                        }\n                    }\n                    if (!(protocoll == \"https\")) return [3 /*break*/, 2];\n                    options = { host: host, path: path };\n                    request = https.request(options, function (res) {\n                        var data = \"\";\n                        res.on(\"data\", function (chunk) {\n                            data += chunk;\n                        });\n                        res.on(\"end\", function () {\n                            then(data);\n                        });\n                    });\n                    request.on(\"error\", function (e) {\n                        console.log(e.message);\n                    });\n                    return [4 /*yield*/, request.end()];\n                case 1:\n                    _a.sent();\n                    return [3 /*break*/, 5];\n                case 2:\n                    if (!(protocoll == \"http\")) return [3 /*break*/, 4];\n                    options = { host: host, path: path };\n                    request = http.request(options, function (res) {\n                        var data = \"\";\n                        res.on(\"data\", function (chunk) {\n                            data += chunk;\n                        });\n                        res.on(\"end\", function () {\n                            then(data);\n                        });\n                    });\n                    request.on(\"error\", function (e) {\n                        console.log(e.message);\n                    });\n                    return [4 /*yield*/, request.end()];\n                case 3:\n                    _a.sent();\n                    return [3 /*break*/, 5];\n                case 4: throw new Error('Unknown protocoll \"' + protocoll + '\"');\n                case 5: return [2 /*return*/, ret];\n            }\n        });\n    });\n}\nexports.loadSite = loadSite;\nfunction parseURL(url) {\n    var host, path, protocoll;\n    var match = url.match(/(https|http):\\/\\/?(.[^\\/:]+)/i);\n    if (match != null &&\n        match.length > 2 &&\n        typeof match[2] === \"string\" &&\n        match[2].length > 0) {\n        host = match[2];\n    }\n    var match = url.match(/(https|http):\\/\\/.[^\\/:]+(.*)/i);\n    if (match != null &&\n        match.length > 2 &&\n        typeof match[2] === \"string\" &&\n        match[2].length > 0) {\n        path = match[2];\n    }\n    else {\n        return null;\n    }\n    if (url.startsWith(\"https://\"))\n        protocoll = \"https\";\n    if (url.startsWith(\"http://\"))\n        protocoll = \"http\";\n    return { host: host, path: path, protocoll: protocoll };\n}\nexports.parseURL = parseURL;\nfunction downloadFile(out, url) {\n    return new Promise(function (resolve, reject) {\n        var file = fs.createWriteStream(out);\n        var request;\n        if (url.startsWith(\"https\")) {\n            console.log(url, out, \"https\");\n            request = https.get(url, function (response) {\n                response.pipe(file);\n            });\n        }\n        else\n            request = http.get(url, function (response) {\n                response.pipe(file);\n            });\n        file.on(\"finish\", resolve).on(\"error\", reject);\n        request.end();\n    });\n}\nexports.downloadFile = downloadFile;\nexports.SiteApi = {\n    loadSite: loadSite,\n    parseURL: parseURL,\n    downloadFile: downloadFile\n};\nglobal.SiteApi = exports.SiteApi;\n","import * as http from \"http\";\r\nimport * as https from \"https\";\r\nimport * as fs from \"fs\";\r\n\r\ndeclare let global: any;\r\n\r\nexport async function loadSite(\r\n  host: string | any,\r\n  then: Function,\r\n  path: string = \"/\",\r\n  protocoll: string = \"https\"\r\n) {\r\n  if (host instanceof Object) {\r\n    if (host.host && host.path) {\r\n      if (host.protocoll) protocoll = host.protocoll;\r\n      path = host.path;\r\n      host = host.host;\r\n    }\r\n  }\r\n  let ret;\r\n  if (protocoll == \"https\") {\r\n    var options = { host: host, path: path };\r\n    var request = https.request(options, function(res) {\r\n      var data = \"\";\r\n      res.on(\"data\", function(chunk) {\r\n        data += chunk;\r\n      });\r\n      res.on(\"end\", function() {\r\n        then(data);\r\n      });\r\n    });\r\n    request.on(\"error\", function(e) {\r\n      console.log(e.message);\r\n    });\r\n    await request.end();\r\n  } else if (protocoll == \"http\") {\r\n    var options = { host: host, path: path };\r\n    var request = http.request(options, function(res) {\r\n      var data = \"\";\r\n      res.on(\"data\", function(chunk) {\r\n        data += chunk;\r\n      });\r\n      res.on(\"end\", function() {\r\n        then(data);\r\n      });\r\n    });\r\n    request.on(\"error\", function(e) {\r\n      console.log(e.message);\r\n    });\r\n    await request.end();\r\n  } else throw new Error('Unknown protocoll \"' + protocoll + '\"');\r\n  return ret;\r\n}\r\n\r\nexport function parseURL(url: string) {\r\n  let host, path, protocoll;\r\n  var match = url.match(/(https|http):\\/\\/?(.[^\\/:]+)/i);\r\n  if (\r\n    match != null &&\r\n    match.length > 2 &&\r\n    typeof match[2] === \"string\" &&\r\n    match[2].length > 0\r\n  ) {\r\n    host = match[2];\r\n  }\r\n\r\n  var match = url.match(/(https|http):\\/\\/.[^\\/:]+(.*)/i);\r\n  if (\r\n    match != null &&\r\n    match.length > 2 &&\r\n    typeof match[2] === \"string\" &&\r\n    match[2].length > 0\r\n  ) {\r\n    path = match[2];\r\n  } else {\r\n    return null;\r\n  }\r\n  if (url.startsWith(\"https://\")) protocoll = \"https\";\r\n  if (url.startsWith(\"http://\")) protocoll = \"http\";\r\n  return { host: host, path: path, protocoll: protocoll };\r\n}\r\n\r\nexport function downloadFile(out: string, url: string): Promise<number> {\r\n  return new Promise((resolve, reject) => {\r\n    let file = fs.createWriteStream(out);\r\n    let request: http.ClientRequest;\r\n    if (url.startsWith(\"https\")) {\r\n      console.log(url, out, \"https\");\r\n      request = https.get(url, function(response) {\r\n        response.pipe(file);\r\n      });\r\n    } else\r\n      request = http.get(url, function(response) {\r\n        response.pipe(file);\r\n      });\r\n    file.on(\"finish\", resolve).on(\"error\", reject);\r\n    request.end();\r\n  });\r\n}\r\n\r\nexport let SiteApi: {\r\n  loadSite: (\r\n    host: string | any,\r\n    then: Function,\r\n    path?: string,\r\n    protocoll?: string\r\n  ) => Promise<any>;\r\n  parseURL: (\r\n    url: string\r\n  ) => { host: string | any; path: string; protocoll: \"http\" | \"https\" };\r\n  downloadFile: (out: string, url: string) => Promise<number>;\r\n} = {\r\n  loadSite: loadSite,\r\n  parseURL: parseURL,\r\n  downloadFile: downloadFile\r\n};\r\n\r\nglobal.SiteApi = SiteApi;\r\n"]}