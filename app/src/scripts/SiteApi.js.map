{"version":3,"sources":["SiteApi.js","SiteApi.ts"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","reject","step","resolve","value","e","fulfilled","result","done","then","rejected","next","__generator","body","f","y","t","g","_","label","sent","trys","ops","throw","verb","return","Symbol","iterator","this","n","v","TypeError","op","call","pop","length","push","exports","http","require","https","fs","loadSite","host","path","protocoll","options","request","_a","Object","res","data","on","chunk","console","log","message","end","Error","ret","parseURL","url","match","startsWith","downloadFile","out","file","createWriteStream","get","response","pipe","String","prototype","searchString","indexOf"],"mappings":"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","file":"SiteApi.js","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexports.__esModule = true;\nvar http = require(\"http\");\nvar https = require(\"https\");\nvar fs = require(\"fs\");\nString.prototype.startsWith = function (searchString) {\n    var position = 0;\n    return this.indexOf(searchString, position) === position;\n};\nfunction loadSite(host, then, path, protocoll) {\n    if (path === void 0) { path = \"/\"; }\n    if (protocoll === void 0) { protocoll = \"https\"; }\n    return __awaiter(this, void 0, void 0, function () {\n        var ret, options, request, options, request;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (host instanceof Object) {\n                        if (host.host && host.path) {\n                            if (host.protocoll)\n                                protocoll = host.protocoll;\n                            path = host.path;\n                            host = host.host;\n                        }\n                    }\n                    if (!(protocoll == \"https\")) return [3 /*break*/, 2];\n                    options = { host: host, path: path };\n                    request = https.request(options, function (res) {\n                        var data = '';\n                        res.on('data', function (chunk) {\n                            data += chunk;\n                        });\n                        res.on('end', function () {\n                            then(data);\n                        });\n                    });\n                    request.on('error', function (e) {\n                        console.log(e.message);\n                    });\n                    return [4 /*yield*/, request.end()];\n                case 1:\n                    _a.sent();\n                    return [3 /*break*/, 5];\n                case 2:\n                    if (!(protocoll == \"http\")) return [3 /*break*/, 4];\n                    options = { host: host, path: path };\n                    request = http.request(options, function (res) {\n                        var data = '';\n                        res.on('data', function (chunk) {\n                            data += chunk;\n                        });\n                        res.on('end', function () {\n                            then(data);\n                        });\n                    });\n                    request.on('error', function (e) {\n                        console.log(e.message);\n                    });\n                    return [4 /*yield*/, request.end()];\n                case 3:\n                    _a.sent();\n                    return [3 /*break*/, 5];\n                case 4: throw new Error(\"Unknown protocoll \\\"\" + protocoll + \"\\\"\");\n                case 5: return [2 /*return*/, ret];\n            }\n        });\n    });\n}\nexports.loadSite = loadSite;\nfunction parseURL(url) {\n    var host, path, protocoll;\n    var match = url.match(/(https|http):\\/\\/?(.[^\\/:]+)/i);\n    if (match != null && match.length > 2 && typeof match[2] === 'string' && match[2].length > 0) {\n        host = match[2];\n    }\n    var match = url.match(/(https|http):\\/\\/.[^\\/:]+(.*)/i);\n    if (match != null && match.length > 2 && typeof match[2] === 'string' && match[2].length > 0) {\n        path = match[2];\n    }\n    else {\n        return null;\n    }\n    if (url.startsWith(\"https://\"))\n        protocoll = \"https\";\n    if (url.startsWith(\"http://\"))\n        protocoll = \"http\";\n    return { host: host, path: path, protocoll: protocoll };\n}\nexports.parseURL = parseURL;\nfunction downloadFile(out, url, then) {\n    if (then === void 0) { then = function () { }; }\n    var file = fs.createWriteStream(out);\n    var request;\n    if (url.startsWith(\"https\"))\n        request = https.get(url, function (response) {\n            response.pipe(file);\n        });\n    else\n        request = http.get(url, function (response) {\n            response.pipe(file);\n        });\n    file.on('finish', then);\n    request.end();\n}\nexports.downloadFile = downloadFile;\n","import * as http from 'http';\r\nimport * as https from 'https';\r\nimport * as fs from 'fs';\r\n\r\ndeclare global {\r\n  interface String {\r\n    startsWith(searchString) : boolean;\r\n  }\r\n}\r\n\r\nString.prototype.startsWith = function(searchString) {\r\n  let position = 0;\r\n  return this.indexOf(searchString, position) === position;\r\n};\r\n\r\nexport async function loadSite(host:string|any, then:Function, path:string=\"/\", protocoll:string=\"https\") {\r\n  if(host instanceof Object) {\r\n    if(host.host&&host.path) {\r\n      if(host.protocoll)protocoll = host.protocoll;\r\n      path = host.path;\r\n      host = host.host;\r\n    }\r\n  }\r\n  let ret;\r\n  if(protocoll == \"https\") {\r\n    var options = {host: host, path: path};\r\n    var request = https.request(options, function (res) {\r\n      var data = '';\r\n      res.on('data', function (chunk) {\r\n        data += chunk;\r\n      });\r\n      res.on('end', function () {\r\n        then(data);\r\n      });\r\n    });\r\n    request.on('error', function (e) {\r\n      console.log(e.message);\r\n    });\r\n    await request.end();\r\n  }\r\n  else if(protocoll == \"http\") {\r\n    var options = {host: host, path: path};\r\n    var request = http.request(options, function (res) {\r\n      var data = '';\r\n      res.on('data', function (chunk) {\r\n        data += chunk;\r\n      });\r\n      res.on('end', function () {\r\n        then(data);\r\n      });\r\n    });\r\n    request.on('error', function (e) {\r\n      console.log(e.message);\r\n    });\r\n    await request.end();\r\n  }\r\n  else throw new Error(\"Unknown protocoll \\\"\"+protocoll+\"\\\"\");\r\n  return ret;\r\n}\r\n\r\nexport function parseURL(url:string) {\r\n  let host, path, protocoll;\r\n  var match = url.match(/(https|http):\\/\\/?(.[^\\/:]+)/i);\r\n  if (match != null && match.length > 2 && typeof match[2] === 'string' && match[2].length > 0) {\r\n    host = match[2];\r\n  }\r\n\r\n  var match = url.match(/(https|http):\\/\\/.[^\\/:]+(.*)/i);\r\n  if (match != null && match.length > 2 && typeof match[2] === 'string' && match[2].length > 0) {\r\n    path = match[2];\r\n  }\r\n  else {\r\n    return null;\r\n  }\r\n  if(url.startsWith(\"https://\"))protocoll=\"https\";\r\n  if(url.startsWith(\"http://\"))protocoll=\"http\";\r\n  return {host: host, path: path, protocoll: protocoll};\r\n}\r\n\r\nexport function downloadFile(out:string, url:string, then:(fd: number) => void = function(){}) {\r\n  let file = fs.createWriteStream(out);\r\n  let request;\r\n  if(url.startsWith(\"https\"))request = https.get(url, function(response) {\r\n    response.pipe(file);\r\n  });\r\n  else request = http.get(url, function(response) {\r\n    response.pipe(file);\r\n  });\r\n  file.on('finish', then);\r\n  request.end();\r\n}\r\n"]}