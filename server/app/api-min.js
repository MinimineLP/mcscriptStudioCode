#!/usr/bin/env node
"use strict";exports.__esModule=!0;var http=require("http"),fs=require("fs"),path=require("path"),server_1=require("./server");function startServer(e,r){void 0===e&&(e="."),void 0===r&&(r=80);var t=__dirname+"/htdocs",o=new server_1.default(fs.realpathSync(e)),n=JSON.parse(fs.readFileSync(__dirname+"/contenttypes.json").toString());http.createServer(function(e,r){if("/"==e.url.charAt(e.url.length-1)&&(e.url+="index.html"),console.log('request starting by address "'+e.connection.remoteAddress+'": '+e.url+"..."),"/server"!=e.url){var s=t+e.url;"./"==s&&(s="./index.html");var i=path.extname(s),l="text/html";n[i]&&(l=n[i]),fs.readFile(s,function(e,o){e?"ENOENT"==e.code?fs.readFile(t+"/404.html",function(e,t){e&&console.log("Error reading 404 file (code: "+e.code+") "+e),r.writeHead(200,{"Content-Type":l}),r.end(t,"utf-8")}):(r.writeHead(500),r.end("Sorry, check with the site admin for error: "+e.code+" ..\n"),console.log("Error occured while reading files from fs ("+s+") (code: "+e.code+") "+e),r.end()):(r.writeHead(200,{"Content-Type":l}),r.end(o,"utf-8"))})}else o.execRequest(e,r)}).listen(r),console.log("Running server on port "+r),console.log('Access it via this link: localhost:"'+r+'"')}exports.default=startServer;